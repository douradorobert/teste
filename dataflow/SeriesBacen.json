{
	"name": "SeriesBacen",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "cotacoes",
						"type": "DatasetReference"
					},
					"name": "cotacoes"
				},
				{
					"dataset": {
						"referenceName": "dicionario_cotacao",
						"type": "DatasetReference"
					},
					"name": "dicionario"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "SeriesBacen0",
						"type": "DatasetReference"
					},
					"name": "ColetorSeriesBacen0"
				},
				{
					"dataset": {
						"referenceName": "SeriesBacen1",
						"type": "DatasetReference"
					},
					"name": "ColetorSeriesBacen1"
				},
				{
					"dataset": {
						"referenceName": "SeriesBacen2",
						"type": "DatasetReference"
					},
					"name": "ColetorSeriesBacen2"
				}
			],
			"transformations": [
				{
					"name": "DerivedColumn1"
				},
				{
					"name": "join"
				},
				{
					"name": "Selecionar1"
				},
				{
					"name": "SelectSellPrice"
				},
				{
					"name": "SelectSellPriceDollar1"
				},
				{
					"name": "SelectSellPriceDollar0"
				},
				{
					"name": "RemoveNull0"
				},
				{
					"name": "RemoveNull1"
				},
				{
					"name": "RemoveNull2"
				}
			],
			"script": "source(output(\n\t\tdata as string,\n\t\tcodigo as string,\n\t\ttipo as string,\n\t\tmoeda as string,\n\t\tcompra_real as string,\n\t\tvenda_real as string,\n\t\tcompra_dolar as string,\n\t\tvenda_dolar as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> cotacoes\nsource(output(\n\t\tmoeda as string,\n\t\talias0_sellpricedollar as string,\n\t\talias1_sellpricedollar as string,\n\t\talias0_sellprice as string\n\t),\n\tallowSchemaDrift: true,\n\tvalidateSchema: false,\n\tignoreNoFilesFound: false) ~> dicionario\nSelecionar1 derive(alias0_sellpricedollar = iif(!isNull(alias0_sellpricedollar),\r\n    concat(\"<SERIE code=\\\"\", alias0_sellpricedollar,\"\\\" value=\\\"\", sellpricedollar,\"\\\"/>\"),\r\n    alias0_sellpricedollar),\n\t\talias1_sellpricedollar = iif(!isNull(alias1_sellpricedollar),\r\n    concat(\"<SERIE code=\\\"\", alias1_sellpricedollar,\"\\\" value=\\\"\", sellpricedollar,\"\\\"/>\"),\r\n    alias1_sellpricedollar),\n\t\talias0_sellprice = iif(!isNull(alias0_sellprice),\r\n    concat(\"<SERIE code=\\\"\", alias0_sellprice,\"\\\" value=\\\"\", sellprice,\"\\\"/>\"),\r\n    alias0_sellprice)) ~> DerivedColumn1\ncotacoes, dicionario join(cotacoes@moeda == dicionario@moeda,\n\tjoinType:'right',\n\tbroadcast: 'auto')~> join\njoin select(mapColumn(\n\t\tmoeda = cotacoes@moeda,\n\t\tbuyprice = compra_real,\n\t\tsellprice = venda_real,\n\t\tbuypricedollar = venda_real,\n\t\tsellpricedollar = compra_dolar,\n\t\talias0_sellpricedollar,\n\t\talias1_sellpricedollar,\n\t\talias0_sellprice\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> Selecionar1\nDerivedColumn1 select(mapColumn(\n\t\talias0_sellprice\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectSellPrice\nDerivedColumn1 select(mapColumn(\n\t\talias1_sellpricedollar\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectSellPriceDollar1\nDerivedColumn1 select(mapColumn(\n\t\talias0_sellpricedollar\n\t),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> SelectSellPriceDollar0\nSelectSellPriceDollar0 filter(!isNull(alias0_sellpricedollar)) ~> RemoveNull0\nSelectSellPriceDollar1 filter(!isNull(alias1_sellpricedollar)) ~> RemoveNull1\nSelectSellPrice filter(!isNull(alias0_sellprice)) ~> RemoveNull2\nRemoveNull0 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\t{26052021;5;A;AFN;0} as string,\n\t\t{06687;0} as string,\n\t\t{06807;781} as string,\n\t\t{000;795} as string,\n\t\t{000} as string\n\t),\n\tfilePattern:(concat(\"SeriesBacen0\", currentTimestamp())),\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> ColetorSeriesBacen0\nRemoveNull1 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tColumn_1 as string,\n\t\tColumn_2 as string,\n\t\tColumn_3 as string,\n\t\tColumn_4 as string,\n\t\tColumn_5 as string\n\t),\n\tfilePattern:'concat(\"SeriesBacen1\", currentTimestamp())',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> ColetorSeriesBacen1\nRemoveNull2 sink(allowSchemaDrift: true,\n\tvalidateSchema: false,\n\tinput(\n\t\tColumn_1 as string,\n\t\tColumn_2 as string,\n\t\tColumn_3 as string,\n\t\tColumn_4 as string,\n\t\tColumn_5 as string\n\t),\n\tfilePattern:'concat(\"SeriesBacen2\", currentTimestamp())',\n\tskipDuplicateMapInputs: true,\n\tskipDuplicateMapOutputs: true) ~> ColetorSeriesBacen2"
		}
	}
}